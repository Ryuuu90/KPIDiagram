{"ast":null,"code":"var _jsxFileName = \"/Users/khalidabourkia/Desktop/diagram/client/src/components/KPIDiagram.jsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect, useMemo, useRef, useState, memo } from 'react';\nimport ReactFlow, { Background, Controls, useNodesState, useReactFlow, useEdgesState, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport axios from 'axios';\n\n// CustomNode component\n// import { motion, AnimatePresence } from 'framer-motion';\nimport { motion } from 'framer-motion';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CustomNode = /*#__PURE__*/memo(_c = ({\n  data\n}) => {\n  // console.log(data);\n  return /*#__PURE__*/_jsxDEV(motion.div, {\n    initial: {\n      opacity: 0,\n      scale: 0.98\n    },\n    animate: {\n      opacity: 1,\n      scale: 1\n    },\n    exit: {\n      opacity: 0,\n      scale: 0.98\n    },\n    transition: {\n      duration: 0.2\n    },\n    style: {\n      backgroundColor: '#ffffff',\n      border: '1px solid #e5e7eb',\n      // gray-200\n      borderRadius: '12px',\n      padding: '16px',\n      width: 250,\n      boxShadow: '0px 1px 4px rgba(0, 0, 0, 0.05)',\n      fontFamily: 'Inter, sans-serif',\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      style: {\n        opacity: 0\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        fontWeight: 500,\n        color: '#2563eb',\n        marginBottom: 0\n      },\n      children: [\"nodeID : \", data.id]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 12,\n        fontWeight: 500,\n        color: '#2563eb',\n        marginBottom: 4\n      },\n      children: [\"reportName : \", data.reportName]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: 16,\n        color: '#374151'\n      },\n      children: data.label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), data.hasChildren && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: data.onDrill,\n      style: {\n        position: 'absolute',\n        bottom: 8,\n        right: 8,\n        fontSize: 14,\n        border: 'none',\n        borderRadius: '4px',\n        background: '#e0e7ff',\n        color: '#1d4ed8',\n        cursor: 'pointer',\n        padding: '2px 6px'\n      },\n      children: data.expanded ? 'âˆ’' : `${data.childrenNum}`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      style: {\n        opacity: 0\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 21,\n    columnNumber: 5\n  }, this);\n});\n_c2 = CustomNode;\nconst defaultEdgeOptions = {\n  // animated: true,\n  type: 'smoothstep'\n};\nconst KPIDiagram = () => {\n  _s();\n  const [level, setLevel] = useState(0);\n  const newNodesRef = useRef([]);\n  const edgesRef = useRef([]);\n  const expandedNodesRef = useRef(new Set()); // Track expanded nodes\n  const reactFlowWrapper = useRef(null);\n  const reactFlowInstance = useRef(null);\n  const totalChildren = useRef(0);\n  const nextAvailableY = useRef(50);\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const nodeTypes = useMemo(() => ({\n    customNode: CustomNode\n  }), []);\n  const fetchNode = async nodeId => {\n    try {\n      const res = await axios.get(`http://localhost:8000/api/node/${nodeId}`);\n      return res.data.node;\n    } catch (error) {\n      console.error('Error fetching node:', error);\n      return null;\n    }\n  };\n  useEffect(() => {\n    totalChildren.current = 0;\n  }, [level]);\n  const removeDescendants = parentId => {\n    const toRemove = new Set();\n    const stack = [parentId];\n    while (stack.length > 0) {\n      const current = stack.pop();\n\n      // Find all direct children of current node\n      const children = edgesRef.current.filter(e => e.source === current).map(e => e.target);\n      for (const childId of children) {\n        // Check if child has other parents besides `current`\n        let otherParents = edgesRef.current.filter(e => e.target === childId && e.source !== current);\n\n        // let removeParents = [];\n        otherParents = otherParents.filter(par => {\n          let source = par.source;\n          while (true) {\n            const parentEdge = edgesRef.current.find(e => e.target === source);\n            if (!parentEdge) return true;\n            source = parentEdge.source;\n            if (source === current) return false;\n          }\n        });\n        // console.log(otherParents.length);\n        if (otherParents.length === 0) {\n          // No other parents, safe to remove this child and continue recursion\n          stack.push(childId);\n          toRemove.add(childId);\n        }\n\n        // else: child has other parents, so keep it\n      }\n    }\n\n    // Remove all descendant nodes that are safe to remove\n    newNodesRef.current = newNodesRef.current.filter(n => !toRemove.has(n.id));\n\n    // Remove all edges where source or target is in toRemove\n    edgesRef.current = edgesRef.current.filter(e => !toRemove.has(e.source) && !toRemove.has(e.target));\n\n    // Remove parent from expanded set\n    expandedNodesRef.current.delete(parentId);\n\n    // Mark the parent node as collapsed (expanded: false)\n\n    newNodesRef.current = newNodesRef.current.map(n => n.id === parentId ? {\n      ...n,\n      data: {\n        ...n.data,\n        expanded: false\n      }\n    } : n);\n  };\n\n  // Helper function to compute bounding box of nodes by id list\n  const computeBounds = nodes => {\n    if (nodes.length === 0) return null;\n    let minX = nodes[0].position.x;\n    let minY = nodes[0].position.y;\n    let maxX = nodes[0].position.x;\n    let maxY = nodes[0].position.y;\n    nodes.forEach(({\n      position,\n      style\n    }) => {\n      var _style$width, _style$height;\n      const width = (_style$width = style === null || style === void 0 ? void 0 : style.width) !== null && _style$width !== void 0 ? _style$width : 180; // default width if not specified\n      const height = (_style$height = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height !== void 0 ? _style$height : 80; // default height if not specified\n      minX = Math.min(minX, position.x);\n      minY = Math.min(minY, position.y);\n      maxX = Math.max(maxX, position.x + width);\n      maxY = Math.max(maxY, position.y + height);\n    });\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  };\n  const handleDrill = useCallback(async nodeId => {\n    var _parentNode$position, _parentNode$position2, _parentNode$style$hei, _parentNode$style;\n    const isExpanded = expandedNodesRef.current.has(nodeId);\n    if (isExpanded) {\n      removeDescendants(nodeId);\n      setNodes(newNodesRef.current);\n      setEdges(edgesRef.current);\n      return;\n    }\n    const node = await fetchNode(nodeId);\n    if (!node || !node.childrenData) return;\n    const reportName = node.reportName;\n    const entries = Object.entries(node.childrenData);\n    const parentNode = newNodesRef.current.find(n => n.id === nodeId);\n    const baseX = (parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$position = parentNode.position) === null || _parentNode$position === void 0 ? void 0 : _parentNode$position.x) + 450 || 250;\n    const verticalSpacing = 120;\n    const existingNodes = newNodesRef.current;\n    function isOverlappingRange(yStart, yEnd) {\n      return existingNodes.some(({\n        position,\n        style\n      }) => {\n        var _style$height2;\n        const nodeHeight = (_style$height2 = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height2 !== void 0 ? _style$height2 : 80;\n        const nodeYStart = position.y;\n        const nodeYEnd = nodeYStart + nodeHeight;\n        return !(yEnd < nodeYStart || yStart > nodeYEnd);\n      });\n    }\n    const parentY = (parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$position2 = parentNode.position) === null || _parentNode$position2 === void 0 ? void 0 : _parentNode$position2.y) || 0;\n\n    // Total height for children block\n    const groupHeight = (entries.length - 1) * verticalSpacing;\n\n    // Initial top of children block (so children centered around parentY)\n    let startY = parentY - groupHeight / 2;\n\n    // Calculate children positions evenly spaced\n    const childrenPositions = entries.map((_, i) => startY + i * verticalSpacing);\n\n    // Calculate vertical bounds of children group\n    let topY = childrenPositions[0];\n    let bottomY = childrenPositions[childrenPositions.length - 1] + ((_parentNode$style$hei = parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$style = parentNode.style) === null || _parentNode$style === void 0 ? void 0 : _parentNode$style.height) !== null && _parentNode$style$hei !== void 0 ? _parentNode$style$hei : 80);\n\n    // Shift children group down until no overlap with existing nodes\n    let offset = 0;\n    while (isOverlappingRange(topY + offset, bottomY + offset)) {\n      offset += verticalSpacing;\n    }\n\n    // Apply offset to children positions\n    const finalChildrenPositions = childrenPositions.map(y => y + offset);\n\n    // Parent stays fixed at parentY, children shifted by offset\n\n    // Update parent node expanded state (position unchanged)\n    newNodesRef.current = newNodesRef.current.map(n => n.id === nodeId ? {\n      ...n,\n      data: {\n        ...n.data,\n        expanded: true\n      }\n    } : n);\n\n    // Add children nodes with final positions\n    entries.forEach(([childId, childLabel], index) => {\n      const childY = finalChildrenPositions[index];\n      edgesRef.current.push({\n        id: `e-${nodeId}-${childId}`,\n        source: nodeId,\n        sourceHandle: 'a',\n        target: childId,\n        targetHandle: 'a'\n      });\n      newNodesRef.current.push({\n        id: childId,\n        type: 'customNode',\n        position: {\n          x: baseX,\n          y: childY\n        },\n        data: {\n          label: childLabel.label,\n          id: childId,\n          reportName: reportName,\n          hasChildren: childLabel.hasChildren,\n          childrenNum: childLabel.childrenNum,\n          expanded: false,\n          onDrill: () => handleDrill(childId)\n        }\n      });\n    });\n    expandedNodesRef.current.add(nodeId);\n\n    // Deduplicate nodes and edges\n    const uniqueNodes = Array.from(new Map(newNodesRef.current.map(n => [n.id, n])).values());\n    const uniqueEdges = Array.from(new Map(edgesRef.current.map(e => [e.id, e])).values());\n    setNodes(uniqueNodes);\n    setEdges(uniqueEdges);\n    setLevel(prevLevel => prevLevel + 1);\n\n    // Fit view to updated subtree\n    const subtreeNodeIds = [nodeId, ...entries.map(([childId]) => childId)];\n    const subtreeNodes = newNodesRef.current.filter(n => subtreeNodeIds.includes(n.id));\n    const bounds = computeBounds(subtreeNodes);\n    if (bounds && reactFlowInstance.current) {\n      reactFlowInstance.current.fitBounds(bounds, {\n        padding: 0.4,\n        maxZoom: 1.5\n      });\n    }\n  }, [handleDrill]);\n  const onInit = useCallback(rfi => {\n    reactFlowInstance.current = rfi;\n  }, []);\n  const fitViewWithDelay = () => {\n    setTimeout(() => {\n      if (reactFlowInstance.current) {\n        reactFlowInstance.current.fitView({\n          padding: 0.2\n        });\n      }\n    }, 100);\n  };\n  useEffect(() => {\n    const loadRoot = async () => {\n      const root = await fetchNode('EC140');\n      if (!root) return;\n      const rootId = root.parentId || 'EC140';\n      newNodesRef.current.push({\n        id: rootId,\n        type: 'customNode',\n        position: {\n          x: 500,\n          y: 50\n        },\n        data: {\n          label: root.parentName || 'Root Node',\n          id: rootId,\n          reportName: root.reportName,\n          hasChildren: true,\n          childrenNum: Object.entries(root.childrenData).length,\n          expanded: false,\n          onDrill: () => handleDrill(rootId)\n        }\n      });\n      setNodes(newNodesRef.current);\n    };\n    loadRoot();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      width: '100vw',\n      height: '100vh'\n    },\n    ref: reactFlowWrapper,\n    children: /*#__PURE__*/_jsxDEV(ReactFlow, {\n      nodes: nodes,\n      edges: edges,\n      onNodesChange: onNodesChange,\n      onEdgesChange: onEdgesChange,\n      nodeTypes: nodeTypes,\n      fitView: true,\n      fitViewOptions: {\n        padding: 0.4\n      },\n      onInit: onInit,\n      defaultEdgeOptions: defaultEdgeOptions,\n      children: [/*#__PURE__*/_jsxDEV(Background, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 375,\n    columnNumber: 5\n  }, this);\n};\n_s(KPIDiagram, \"Ih0a/8RjEy6VEIH5Sn9g9WRq/AY=\", false, function () {\n  return [useNodesState, useEdgesState];\n});\n_c3 = KPIDiagram;\nexport default KPIDiagram;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"CustomNode$memo\");\n$RefreshReg$(_c2, \"CustomNode\");\n$RefreshReg$(_c3, \"KPIDiagram\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","memo","ReactFlow","Background","Controls","useNodesState","useReactFlow","useEdgesState","Handle","Position","axios","motion","jsxDEV","_jsxDEV","CustomNode","_c","data","div","initial","opacity","scale","animate","exit","transition","duration","style","backgroundColor","border","borderRadius","padding","width","boxShadow","fontFamily","position","children","type","Left","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","fontWeight","color","marginBottom","id","reportName","label","hasChildren","onClick","onDrill","bottom","right","background","cursor","expanded","childrenNum","Right","_c2","defaultEdgeOptions","KPIDiagram","_s","level","setLevel","newNodesRef","edgesRef","expandedNodesRef","Set","reactFlowWrapper","reactFlowInstance","totalChildren","nextAvailableY","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","nodeTypes","customNode","fetchNode","nodeId","res","get","node","error","console","current","removeDescendants","parentId","toRemove","stack","length","pop","filter","e","source","map","target","childId","otherParents","par","parentEdge","find","push","add","n","has","delete","computeBounds","minX","x","minY","y","maxX","maxY","forEach","_style$width","_style$height","height","Math","min","max","handleDrill","_parentNode$position","_parentNode$position2","_parentNode$style$hei","_parentNode$style","isExpanded","childrenData","entries","Object","parentNode","baseX","verticalSpacing","existingNodes","isOverlappingRange","yStart","yEnd","some","_style$height2","nodeHeight","nodeYStart","nodeYEnd","parentY","groupHeight","startY","childrenPositions","_","i","topY","bottomY","offset","finalChildrenPositions","childLabel","index","childY","sourceHandle","targetHandle","uniqueNodes","Array","from","Map","values","uniqueEdges","prevLevel","subtreeNodeIds","subtreeNodes","includes","bounds","fitBounds","maxZoom","onInit","rfi","fitViewWithDelay","setTimeout","fitView","loadRoot","root","rootId","parentName","ref","fitViewOptions","_c3","$RefreshReg$"],"sources":["/Users/khalidabourkia/Desktop/diagram/client/src/components/KPIDiagram.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState , memo} from 'react';\nimport ReactFlow, {\n  Background,\n  Controls,\n  useNodesState,\n  useReactFlow, \n  useEdgesState,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport axios from 'axios';\n\n// CustomNode component\n// import { motion, AnimatePresence } from 'framer-motion';\nimport { motion } from 'framer-motion';\n\nconst CustomNode = memo(({ data }) => {\n  // console.log(data);\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.98 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.98 }}\n      transition={{ duration: 0.2 }}\n      style={{\n        backgroundColor: '#ffffff',\n        border: '1px solid #e5e7eb', // gray-200\n        borderRadius: '12px',\n        padding: '16px',\n        width: 250,\n        boxShadow: '0px 1px 4px rgba(0, 0, 0, 0.05)',\n        fontFamily: 'Inter, sans-serif',\n        position: 'relative',\n      }}\n    >\n      <Handle type=\"target\" position={Position.Left} style={{ opacity: 0 }} />\n\n      {/* Status bar or tag */}\n      <div style={{\n        fontSize: 12,\n        fontWeight: 500,\n        color: '#2563eb',\n        marginBottom: 0\n      }}>\n        nodeID : {data.id}\n      </div>\n\n      {/* Title */}\n      <div style={{\n        fontSize: 12,\n        fontWeight: 500,\n        color: '#2563eb',\n        marginBottom: 4\n      }}>\n        reportName : {data.reportName}\n      </div>\n\n      {/* Example metric rows */}\n      <div style={{ fontSize: 16, color: '#374151' }}>\n        {data.label}\n      </div>\n\n      {/* Expand/collapse button */}\n      {data.hasChildren && (\n        <button\n          onClick={data.onDrill}\n          style={{\n            position: 'absolute',\n            bottom: 8,\n            right: 8,\n            fontSize: 14,\n            border: 'none',\n            borderRadius: '4px',\n            background: '#e0e7ff',\n            color: '#1d4ed8',\n            cursor: 'pointer',\n            padding: '2px 6px'\n          }}\n        >\n          {data.expanded ? 'âˆ’' : `${data.childrenNum}`}\n        </button>\n      )}\n\n      <Handle type=\"source\" position={Position.Right} style={{ opacity: 0 }} />\n    </motion.div>\n  );\n});\n\n\n\nconst defaultEdgeOptions = {\n  // animated: true,\n  type: 'smoothstep',\n};\n\nconst KPIDiagram = () => {\n  const [level, setLevel] = useState(0);\n  const newNodesRef = useRef([]);\n  const edgesRef = useRef([]);\n  const expandedNodesRef = useRef(new Set()); // Track expanded nodes\n  const reactFlowWrapper = useRef(null);\n  const reactFlowInstance = useRef(null); \n  const totalChildren = useRef(0);\n\n  const nextAvailableY = useRef(50);\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n  const nodeTypes = useMemo(() => ({ customNode: CustomNode }), []);\n\n  const fetchNode = async (nodeId) => {\n    try {\n      const res = await axios.get(`http://localhost:8000/api/node/${nodeId}`);\n      return res.data.node;\n    } catch (error) {\n      console.error('Error fetching node:', error);\n      return null;\n    }\n  };\n\n  useEffect (()=>{\n    totalChildren.current = 0;\n  }, [level])\n  const removeDescendants = (parentId) => {\n    const toRemove = new Set();\n    \n    const stack = [parentId];\n    \n    while (stack.length > 0) {\n      const current = stack.pop();\n      \n      // Find all direct children of current node\n      const children = edgesRef.current\n      .filter(e => e.source === current)\n      .map(e => e.target);\n      \n      for (const childId of children) {\n        // Check if child has other parents besides `current`\n        let otherParents = edgesRef.current.filter(\n          e => e.target === childId && e.source !== current\n        );\n        \n        // let removeParents = [];\n        otherParents = otherParents.filter(par =>{\n          let source = par.source;\n          while(true)\n          {\n            const parentEdge = edgesRef.current.find(e => e.target === source);\n            if(!parentEdge)\n              return true;\n            source = parentEdge.source;\n            if(source === current)\n                return false;\n          }\n        })\n        // console.log(otherParents.length);\n        if (otherParents.length === 0) {\n          // No other parents, safe to remove this child and continue recursion\n          stack.push(childId);\n          toRemove.add(childId);\n        }\n        \n        // else: child has other parents, so keep it\n      }\n    }\n    \n    // Remove all descendant nodes that are safe to remove\n    newNodesRef.current = newNodesRef.current.filter(n => !toRemove.has(n.id));\n  \n    // Remove all edges where source or target is in toRemove\n    edgesRef.current = edgesRef.current.filter(\n      e => !toRemove.has(e.source) && !toRemove.has(e.target)\n    );\n  \n    // Remove parent from expanded set\n    expandedNodesRef.current.delete(parentId);\n  \n    // Mark the parent node as collapsed (expanded: false)\n\n    newNodesRef.current = newNodesRef.current.map(n =>\n      n.id === parentId ? { ...n, data: { ...n.data, expanded: false } } : n\n    );\n  };\n\n  // Helper function to compute bounding box of nodes by id list\n  const computeBounds = (nodes) => {\n    if (nodes.length === 0) return null;\n    let minX = nodes[0].position.x;\n    let minY = nodes[0].position.y;\n    let maxX = nodes[0].position.x;\n    let maxY = nodes[0].position.y;\n\n    nodes.forEach(({ position, style }) => {\n      const width = (style?.width ?? 180); // default width if not specified\n      const height = (style?.height ?? 80); // default height if not specified\n      minX = Math.min(minX, position.x);\n      minY = Math.min(minY, position.y);\n      maxX = Math.max(maxX, position.x + width);\n      maxY = Math.max(maxY, position.y + height);\n    });\n\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n  };\n\n  \n  const handleDrill = useCallback(\n    async (nodeId) => {\n      const isExpanded = expandedNodesRef.current.has(nodeId);\n  \n      if (isExpanded) {\n        removeDescendants(nodeId);\n        setNodes(newNodesRef.current);\n        setEdges(edgesRef.current);\n        return;\n      }\n  \n      const node = await fetchNode(nodeId);\n      if (!node || !node.childrenData) return;\n  \n      const reportName = node.reportName;\n      const entries = Object.entries(node.childrenData);\n  \n      const parentNode = newNodesRef.current.find((n) => n.id === nodeId);\n      const baseX = parentNode?.position?.x + 450 || 250;\n  \n      const verticalSpacing = 120;\n      const existingNodes = newNodesRef.current;\n  \n      function isOverlappingRange(yStart, yEnd) {\n        return existingNodes.some(({ position, style }) => {\n          const nodeHeight = style?.height ?? 80;\n          const nodeYStart = position.y;\n          const nodeYEnd = nodeYStart + nodeHeight;\n          return !(yEnd < nodeYStart || yStart > nodeYEnd);\n        });\n      }\n  \n      const parentY = parentNode?.position?.y || 0;\n  \n      // Total height for children block\n      const groupHeight = (entries.length - 1) * verticalSpacing;\n  \n      // Initial top of children block (so children centered around parentY)\n      let startY = parentY - groupHeight / 2;\n  \n      // Calculate children positions evenly spaced\n      const childrenPositions = entries.map((_, i) => startY + i * verticalSpacing);\n  \n      // Calculate vertical bounds of children group\n      let topY = childrenPositions[0];\n      let bottomY = childrenPositions[childrenPositions.length - 1] + (parentNode?.style?.height ?? 80);\n  \n      // Shift children group down until no overlap with existing nodes\n      let offset = 0;\n      while (isOverlappingRange(topY + offset, bottomY + offset)) {\n        offset += verticalSpacing;\n      }\n  \n      // Apply offset to children positions\n      const finalChildrenPositions = childrenPositions.map(y => y + offset);\n  \n      // Parent stays fixed at parentY, children shifted by offset\n  \n      // Update parent node expanded state (position unchanged)\n      newNodesRef.current = newNodesRef.current.map((n) =>\n        n.id === nodeId\n          ? {\n              ...n,\n              data: { ...n.data, expanded: true },\n            }\n          : n\n      );\n  \n      // Add children nodes with final positions\n      entries.forEach(([childId, childLabel], index) => {\n        const childY = finalChildrenPositions[index];\n  \n        edgesRef.current.push({\n          id: `e-${nodeId}-${childId}`,\n          source: nodeId,\n          sourceHandle: 'a',\n          target: childId,\n          targetHandle: 'a',\n        });\n  \n        newNodesRef.current.push({\n          id: childId,\n          type: 'customNode',\n          position: { x: baseX, y: childY },\n          data: {\n            label: childLabel.label,\n            id: childId,\n            reportName: reportName,\n            hasChildren: childLabel.hasChildren,\n            childrenNum: childLabel.childrenNum,\n            expanded: false,\n            onDrill: () => handleDrill(childId),\n          },\n        });\n      });\n  \n      expandedNodesRef.current.add(nodeId);\n  \n      // Deduplicate nodes and edges\n      const uniqueNodes = Array.from(\n        new Map(newNodesRef.current.map((n) => [n.id, n])).values()\n      );\n      const uniqueEdges = Array.from(\n        new Map(edgesRef.current.map((e) => [e.id, e])).values()\n      );\n  \n      setNodes(uniqueNodes);\n      setEdges(uniqueEdges);\n  \n      setLevel((prevLevel) => prevLevel + 1);\n  \n      // Fit view to updated subtree\n      const subtreeNodeIds = [nodeId, ...entries.map(([childId]) => childId)];\n      const subtreeNodes = newNodesRef.current.filter((n) =>\n        subtreeNodeIds.includes(n.id)\n      );\n      const bounds = computeBounds(subtreeNodes);\n  \n      if (bounds && reactFlowInstance.current) {\n        reactFlowInstance.current.fitBounds(bounds, {\n          padding: 0.4,\n          maxZoom: 1.5,\n        });\n      }\n    },\n    [handleDrill]\n  );\n  \n  \n  const onInit = useCallback((rfi) => {\n    reactFlowInstance.current = rfi;\n  }, []);\n\n  const fitViewWithDelay = () => {\n    setTimeout(() => {\n      if (reactFlowInstance.current) {\n        reactFlowInstance.current.fitView({ padding: 0.2 });\n      }\n    }, 100);\n  };\n\n  useEffect(() => {\n    const loadRoot = async () => {\n      const root = await fetchNode('EC140');\n      if (!root) return;\n\n      const rootId = root.parentId || 'EC140';\n      newNodesRef.current.push({\n        id: rootId,\n        type: 'customNode',\n        position: { x: 500, y: 50 },\n        data: {\n          label: root.parentName || 'Root Node',\n          id: rootId,\n          reportName : root.reportName,\n          hasChildren: true,\n          childrenNum : Object.entries(root.childrenData).length,\n          expanded: false,\n          onDrill: () => handleDrill(rootId),\n        },\n      });\n\n      setNodes(newNodesRef.current);\n    };\n    loadRoot();\n  }, []);\n\n  return (\n    <div style={{ width: '100vw', height: '100vh' }} ref={reactFlowWrapper}>\n      <ReactFlow\n        nodes={nodes}\n        edges={edges}\n        onNodesChange={onNodesChange}\n        onEdgesChange={onEdgesChange}\n        nodeTypes={nodeTypes}\n        fitView\n        fitViewOptions={{ padding: 0.4 }}\n        onInit={onInit}\n        defaultEdgeOptions={defaultEdgeOptions}\n      >\n        <Background />\n        <Controls />\n      </ReactFlow>\n    </div>\n  );\n};\n\nexport default KPIDiagram;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}