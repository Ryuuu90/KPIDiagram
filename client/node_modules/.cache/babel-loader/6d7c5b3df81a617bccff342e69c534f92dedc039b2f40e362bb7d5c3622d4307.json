{"ast":null,"code":"var _jsxFileName = \"/Users/khalidabourkia/Desktop/diagram/client/src/components/KPIDiagram.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useCallback, useEffect, useMemo, useRef, useState, memo } from 'react';\nimport ReactFlow, { Background, Controls, useNodesState, useReactFlow, useEdgesState, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport axios from 'axios';\nimport ReactDOM from 'react-dom';\n\n// CustomNode component\n// import { motion, AnimatePresence } from 'framer-motion';\nimport { motion } from 'framer-motion';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst HoverNode = ({\n  data\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"bg-white border border-gray-300 shadow-xl rounded-md p-4 text-xs text-gray-800 w-64 space-y-1\",\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-sm font-bold text-blue-600\",\n    children: \"Node Info\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 21,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"ID:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 10\n    }, this), \" \", data.id]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 22,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Report:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 10\n    }, this), \" \", data.reportName]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 23,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Label:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 10\n    }, this), \" \", data.label]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 24,\n    columnNumber: 5\n  }, this), data.description && /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Description:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 31\n    }, this), \" \", data.description]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 25,\n    columnNumber: 26\n  }, this), data.type && /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Type:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 24\n    }, this), \" \", data.type]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 26,\n    columnNumber: 19\n  }, this), data.owner && /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Owner:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 25\n    }, this), \" \", data.owner]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 27,\n    columnNumber: 20\n  }, this), data.createdAt && /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Created:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 28,\n      columnNumber: 29\n    }, this), \" \", data.createdAt]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 28,\n    columnNumber: 24\n  }, this), data.nodeScore !== undefined && /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-gray-600\",\n      children: \"Score:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 43\n    }, this), \" \", data.nodeScore]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 38\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 20,\n  columnNumber: 3\n}, this);\n_c = HoverNode;\nconst CustomNode = /*#__PURE__*/_s(/*#__PURE__*/memo(_c2 = _s(({\n  data\n}) => {\n  _s();\n  const [hovered, setHovered] = useState(false);\n  const [tooltipPos, setTooltipPos] = useState({\n    x: 0,\n    y: 0\n  });\n  const nodeRef = useRef(null);\n  useEffect(() => {\n    if (hovered && nodeRef.current) {\n      const rect = nodeRef.current.getBoundingClientRect();\n      setTooltipPos({\n        x: rect.left + rect.width / 2,\n        y: rect.bottom + 65 // above the node\n      });\n    }\n  }, [hovered]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(motion.div, {\n      ref: nodeRef,\n      onMouseEnter: () => setHovered(true),\n      onMouseLeave: () => setHovered(false),\n      initial: {\n        opacity: 0,\n        scale: 0.98\n      },\n      animate: {\n        opacity: 1,\n        scale: 1\n      },\n      exit: {\n        opacity: 0,\n        scale: 0.98\n      },\n      transition: {\n        duration: 0.2\n      },\n      className: \"relative w-[250px] bg-white border border-gray-200 rounded-xl p-4 shadow-sm font-sans\",\n      children: [/*#__PURE__*/_jsxDEV(Handle, {\n        type: \"target\",\n        position: Position.Left,\n        className: \"opacity-0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-xs font-medium text-blue-600 mb-0\",\n        children: [\"nodeID : \", data.id]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-xs font-medium text-blue-600 mb-1\",\n        children: [\"reportName : \", data.reportName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-base text-gray-700\",\n        children: data.label\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }, this), data.hasChildren && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: data.onDrill,\n        className: \"absolute bottom-2 right-2 text-sm bg-indigo-100 text-indigo-700 rounded px-2 py-0.5\",\n        children: data.expanded ? 'âˆ’' : `${data.childrenNum}`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Handle, {\n        type: \"source\",\n        position: Position.Right,\n        className: \"opacity-0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }, this), hovered &&\n    /*#__PURE__*/\n    // ReactDOM.createPortal(\n    _jsxDEV(\"div\", {\n      className: \"z-[99999]\",\n      children: /*#__PURE__*/_jsxDEV(HoverNode, {\n        data: data\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 12\n    }, this)]\n  }, void 0, true);\n}, \"w6k01RHdByJRSD4GFXJchv/HZvE=\")), \"w6k01RHdByJRSD4GFXJchv/HZvE=\");\n_c3 = CustomNode;\nconst defaultEdgeOptions = {\n  // animated: true,\n  type: 'smoothstep'\n};\nconst KPIDiagram = () => {\n  _s2();\n  const [level, setLevel] = useState(0);\n  const newNodesRef = useRef([]);\n  const edgesRef = useRef([]);\n  const expandedNodesRef = useRef(new Set()); // Track expanded nodes\n  const reactFlowWrapper = useRef(null);\n  const reactFlowInstance = useRef(null);\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const nodeTypes = useMemo(() => ({\n    customNode: CustomNode\n  }), []);\n  const fetchNode = async nodeId => {\n    try {\n      const res = await axios.get(`http://localhost:8000/api/node/${nodeId}`);\n      return res.data.node;\n    } catch (error) {\n      console.error('Error fetching node:', error);\n      return null;\n    }\n  };\n  const removeDescendants = parentId => {\n    const toRemove = new Set();\n    const stack = [parentId];\n    while (stack.length > 0) {\n      const current = stack.pop();\n      const children = edgesRef.current.filter(e => e.source === current).map(e => e.target);\n      for (const childId of children) {\n        let otherParents = edgesRef.current.filter(e => e.target === childId && e.source !== current);\n        otherParents = otherParents.filter(par => {\n          let source = par.source;\n          while (true) {\n            const parentEdge = edgesRef.current.find(e => e.target === source);\n            if (!parentEdge) return true;\n            source = parentEdge.source;\n            if (source === current) return false;\n          }\n        });\n        if (otherParents.length === 0) {\n          stack.push(childId);\n          toRemove.add(childId);\n        }\n      }\n    }\n    newNodesRef.current = newNodesRef.current.filter(n => !toRemove.has(n.id));\n    edgesRef.current = edgesRef.current.filter(e => !toRemove.has(e.source) && !toRemove.has(e.target));\n    expandedNodesRef.current.delete(parentId);\n    newNodesRef.current = newNodesRef.current.map(n => n.id === parentId ? {\n      ...n,\n      data: {\n        ...n.data,\n        expanded: false\n      }\n    } : n);\n  };\n  const computeBounds = nodes => {\n    if (nodes.length === 0) return null;\n    let minX = nodes[0].position.x;\n    let minY = nodes[0].position.y;\n    let maxX = nodes[0].position.x;\n    let maxY = nodes[0].position.y;\n    nodes.forEach(({\n      position,\n      style\n    }) => {\n      var _style$width, _style$height;\n      const width = (_style$width = style === null || style === void 0 ? void 0 : style.width) !== null && _style$width !== void 0 ? _style$width : 180;\n      const height = (_style$height = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height !== void 0 ? _style$height : 80;\n      minX = Math.min(minX, position.x);\n      minY = Math.min(minY, position.y);\n      maxX = Math.max(maxX, position.x + width);\n      maxY = Math.max(maxY, position.y + height);\n    });\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  };\n  const handleDrill = useCallback(async nodeId => {\n    var _parentNode$position, _parentNode$position2;\n    const isExpanded = expandedNodesRef.current.has(nodeId);\n    if (isExpanded) {\n      removeDescendants(nodeId);\n      setNodes(newNodesRef.current);\n      setEdges(edgesRef.current);\n      return;\n    }\n    const node = await fetchNode(nodeId);\n    if (!node || !node.childrenData) return;\n    const reportName = node.reportName;\n    const nextLevel = parseInt(node.level) + 1 || level + 1;\n    const entries = Object.entries(node.childrenData);\n    const totalChildren = entries.length;\n    const parentNode = newNodesRef.current.find(n => n.id === nodeId);\n    const baseX = (parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$position = parentNode.position) === null || _parentNode$position === void 0 ? void 0 : _parentNode$position.x) + 450 || 250;\n    const centerY = (parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$position2 = parentNode.position) === null || _parentNode$position2 === void 0 ? void 0 : _parentNode$position2.y) || 0;\n    const verticalSpacing = 120;\n    let startY = 0;\n    function groupBounds(yStart) {\n      const firstChildY = yStart;\n      const lastChildY = yStart + (totalChildren - 1) * verticalSpacing;\n      const nodeHeight = 80;\n      return {\n        top: firstChildY,\n        bottom: lastChildY + nodeHeight\n      };\n    }\n    const existingNodes = newNodesRef.current;\n    function isOverlapping(yStart, yEnd) {\n      return existingNodes.some(({\n        position,\n        style\n      }) => {\n        var _style$height2;\n        const nodeHeight = (_style$height2 = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height2 !== void 0 ? _style$height2 : 80;\n        const nodeYStart = position.y;\n        const nodeYEnd = nodeYStart + nodeHeight;\n        return !(yEnd < nodeYStart || yStart > nodeYEnd);\n      });\n    }\n    let yOffset = 0;\n    while (isOverlapping(groupBounds(startY + yOffset).top, groupBounds(startY + yOffset).bottom)) {\n      yOffset += verticalSpacing;\n    }\n    startY += yOffset;\n    entries.forEach(([childId, childLabel], index) => {\n      const childY = startY + index * verticalSpacing;\n      edgesRef.current.push({\n        id: `e-${nodeId}-${childId}`,\n        source: nodeId,\n        sourceHandle: 'a',\n        target: childId,\n        targetHandle: 'a'\n      });\n      newNodesRef.current.push({\n        id: childId,\n        type: 'customNode',\n        position: {\n          x: baseX,\n          y: childY\n        },\n        data: {\n          label: childLabel.label,\n          id: childId,\n          reportName: reportName,\n          hasChildren: childLabel.hasChildren,\n          childrenNum: childLabel.childrenNum,\n          expanded: false,\n          onDrill: () => handleDrill(childId)\n        }\n      });\n    });\n    expandedNodesRef.current.add(nodeId);\n    newNodesRef.current = newNodesRef.current.map(n => n.id === nodeId ? {\n      ...n,\n      data: {\n        ...n.data,\n        expanded: true\n      }\n    } : n);\n    const uniqueNodes = Array.from(new Map(newNodesRef.current.map(n => [n.id, n])).values());\n    const uniqueEdges = Array.from(new Map(edgesRef.current.map(e => [e.id, e])).values());\n    setNodes(uniqueNodes);\n    setEdges(uniqueEdges);\n    setLevel(nextLevel);\n    const subtreeNodeIds = [nodeId, ...entries.map(([childId]) => childId)];\n    const subtreeNodes = newNodesRef.current.filter(n => subtreeNodeIds.includes(n.id));\n    const bounds = computeBounds(subtreeNodes);\n    if (bounds && reactFlowInstance.current) {\n      reactFlowInstance.current.fitBounds(bounds, {\n        padding: 0.4,\n        maxZoom: 1.5\n      });\n    }\n  }, [level, reactFlowInstance]);\n  const onInit = useCallback(rfi => {\n    reactFlowInstance.current = rfi;\n  }, []);\n  const fitViewWithDelay = () => {\n    setTimeout(() => {\n      if (reactFlowInstance.current) {\n        reactFlowInstance.current.fitView({\n          padding: 0.2\n        });\n      }\n    }, 100);\n  };\n  useEffect(() => {\n    const loadRoot = async () => {\n      const root = await fetchNode('EC140');\n      if (!root) return;\n      const rootId = root.parentId || 'EC140';\n      newNodesRef.current.push({\n        id: rootId,\n        type: 'customNode',\n        position: {\n          x: 500,\n          y: 50\n        },\n        data: {\n          label: root.parentName || 'Root Node',\n          id: rootId,\n          reportName: root.reportName,\n          hasChildren: true,\n          childrenNum: Object.entries(root.childrenData).length,\n          expanded: false,\n          onDrill: () => handleDrill(rootId)\n        }\n      });\n      setNodes(newNodesRef.current);\n    };\n    loadRoot();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      width: '100vw',\n      height: '100vh'\n    },\n    ref: reactFlowWrapper,\n    children: /*#__PURE__*/_jsxDEV(ReactFlow, {\n      nodes: nodes,\n      edges: edges,\n      onNodesChange: onNodesChange,\n      onEdgesChange: onEdgesChange,\n      nodeTypes: nodeTypes,\n      fitView: true,\n      fitViewOptions: {\n        padding: 0.4\n      },\n      onInit: onInit,\n      defaultEdgeOptions: defaultEdgeOptions,\n      children: [/*#__PURE__*/_jsxDEV(Background, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 335,\n    columnNumber: 5\n  }, this);\n};\n_s2(KPIDiagram, \"Arw5iXeEA9N2Y8TBBAbYA8S63Hc=\", false, function () {\n  return [useNodesState, useEdgesState];\n});\n_c4 = KPIDiagram;\nexport default KPIDiagram;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"HoverNode\");\n$RefreshReg$(_c2, \"CustomNode$memo\");\n$RefreshReg$(_c3, \"CustomNode\");\n$RefreshReg$(_c4, \"KPIDiagram\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","memo","ReactFlow","Background","Controls","useNodesState","useReactFlow","useEdgesState","Handle","Position","axios","ReactDOM","motion","jsxDEV","_jsxDEV","Fragment","_Fragment","HoverNode","data","className","children","fileName","_jsxFileName","lineNumber","columnNumber","id","reportName","label","description","type","owner","createdAt","nodeScore","undefined","_c","CustomNode","_s","_c2","hovered","setHovered","tooltipPos","setTooltipPos","x","y","nodeRef","current","rect","getBoundingClientRect","left","width","bottom","div","ref","onMouseEnter","onMouseLeave","initial","opacity","scale","animate","exit","transition","duration","position","Left","hasChildren","onClick","onDrill","expanded","childrenNum","Right","_c3","defaultEdgeOptions","KPIDiagram","_s2","level","setLevel","newNodesRef","edgesRef","expandedNodesRef","Set","reactFlowWrapper","reactFlowInstance","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","nodeTypes","customNode","fetchNode","nodeId","res","get","node","error","console","removeDescendants","parentId","toRemove","stack","length","pop","filter","e","source","map","target","childId","otherParents","par","parentEdge","find","push","add","n","has","delete","computeBounds","minX","minY","maxX","maxY","forEach","style","_style$width","_style$height","height","Math","min","max","handleDrill","_parentNode$position","_parentNode$position2","isExpanded","childrenData","nextLevel","parseInt","entries","Object","totalChildren","parentNode","baseX","centerY","verticalSpacing","startY","groupBounds","yStart","firstChildY","lastChildY","nodeHeight","top","existingNodes","isOverlapping","yEnd","some","_style$height2","nodeYStart","nodeYEnd","yOffset","childLabel","index","childY","sourceHandle","targetHandle","uniqueNodes","Array","from","Map","values","uniqueEdges","subtreeNodeIds","subtreeNodes","includes","bounds","fitBounds","padding","maxZoom","onInit","rfi","fitViewWithDelay","setTimeout","fitView","loadRoot","root","rootId","parentName","fitViewOptions","_c4","$RefreshReg$"],"sources":["/Users/khalidabourkia/Desktop/diagram/client/src/components/KPIDiagram.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState , memo} from 'react';\nimport ReactFlow, {\n  Background,\n  Controls,\n  useNodesState,\n  useReactFlow, \n  useEdgesState,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport axios from 'axios';\nimport ReactDOM from 'react-dom';\n\n// CustomNode component\n// import { motion, AnimatePresence } from 'framer-motion';\nimport { motion } from 'framer-motion';\n\nconst HoverNode = ({ data }) => (\n  <div className=\"bg-white border border-gray-300 shadow-xl rounded-md p-4 text-xs text-gray-800 w-64 space-y-1\">\n    <div className=\"text-sm font-bold text-blue-600\">Node Info</div>\n    <div><span className=\"font-semibold text-gray-600\">ID:</span> {data.id}</div>\n    <div><span className=\"font-semibold text-gray-600\">Report:</span> {data.reportName}</div>\n    <div><span className=\"font-semibold text-gray-600\">Label:</span> {data.label}</div>\n    {data.description && <div><span className=\"font-semibold text-gray-600\">Description:</span> {data.description}</div>}\n    {data.type && <div><span className=\"font-semibold text-gray-600\">Type:</span> {data.type}</div>}\n    {data.owner && <div><span className=\"font-semibold text-gray-600\">Owner:</span> {data.owner}</div>}\n    {data.createdAt && <div><span className=\"font-semibold text-gray-600\">Created:</span> {data.createdAt}</div>}\n    {data.nodeScore !== undefined && <div><span className=\"font-semibold text-gray-600\">Score:</span> {data.nodeScore}</div>}\n  </div>\n);\n\nconst CustomNode = memo(({ data }) => {\n  const [hovered, setHovered] = useState(false);\n  const [tooltipPos, setTooltipPos] = useState({ x: 0, y: 0 });\n  const nodeRef = useRef(null);\n\n  useEffect(() => {\n    if (hovered && nodeRef.current) {\n      const rect = nodeRef.current.getBoundingClientRect();\n      setTooltipPos({\n        x: rect.left + rect.width / 2,\n        y: rect.bottom + 65, // above the node\n      });\n    }\n  }, [hovered]);\n\n  return (\n    <>\n      <motion.div\n        ref={nodeRef}\n        onMouseEnter={() => setHovered(true)}\n        onMouseLeave={() => setHovered(false)}\n        initial={{ opacity: 0, scale: 0.98 }}\n        animate={{ opacity: 1, scale: 1 }}\n        exit={{ opacity: 0, scale: 0.98 }}\n        transition={{ duration: 0.2 }}\n        className=\"relative w-[250px] bg-white border border-gray-200 rounded-xl p-4 shadow-sm font-sans\"\n      >\n        <Handle type=\"target\" position={Position.Left} className=\"opacity-0\" />\n\n        <div className=\"text-xs font-medium text-blue-600 mb-0\">\n          nodeID : {data.id}\n        </div>\n\n        <div className=\"text-xs font-medium text-blue-600 mb-1\">\n          reportName : {data.reportName}\n        </div>\n\n        <div className=\"text-base text-gray-700\">{data.label}</div>\n\n        {data.hasChildren && (\n          <button\n            onClick={data.onDrill}\n            className=\"absolute bottom-2 right-2 text-sm bg-indigo-100 text-indigo-700 rounded px-2 py-0.5\"\n          >\n            {data.expanded ? 'âˆ’' : `${data.childrenNum}`}\n          </button>\n        )}\n\n        <Handle type=\"source\" position={Position.Right} className=\"opacity-0\" />\n      </motion.div>\n      {hovered &&\n        // ReactDOM.createPortal(\n          (<div className='z-[99999]'>\n            <HoverNode data={data} />\n          </div>)\n        }\n\n    </>\n  );\n});\n\n\nconst defaultEdgeOptions = {\n  // animated: true,\n  type: 'smoothstep',\n};\n\nconst KPIDiagram = () => {\n  const [level, setLevel] = useState(0);\n  const newNodesRef = useRef([]);\n  const edgesRef = useRef([]);\n  const expandedNodesRef = useRef(new Set()); // Track expanded nodes\n  const reactFlowWrapper = useRef(null);\n  const reactFlowInstance = useRef(null); \n\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n  const nodeTypes = useMemo(() => ({ customNode: CustomNode }), []);\n\n  const fetchNode = async (nodeId) => {\n    try {\n      const res = await axios.get(`http://localhost:8000/api/node/${nodeId}`);\n      return res.data.node;\n    } catch (error) {\n      console.error('Error fetching node:', error);\n      return null;\n    }\n  };\n  const removeDescendants = (parentId) => {\n    const toRemove = new Set();\n    \n    const stack = [parentId];\n    \n    while (stack.length > 0) {\n      const current = stack.pop();\n    \n      const children = edgesRef.current\n      .filter(e => e.source === current)\n      .map(e => e.target);\n      \n      for (const childId of children) {\n        let otherParents = edgesRef.current.filter(\n          e => e.target === childId && e.source !== current\n        );\n        otherParents = otherParents.filter(par =>{\n          let source = par.source;\n          while(true)\n          {\n            const parentEdge = edgesRef.current.find(e => e.target === source);\n            if(!parentEdge)\n              return true;\n            source = parentEdge.source;\n            if(source === current)\n                return false;\n          }\n        })\n        if (otherParents.length === 0) {\n          stack.push(childId);\n          toRemove.add(childId);\n        }\n        \n      }\n    }\n    newNodesRef.current = newNodesRef.current.filter(n => !toRemove.has(n.id));\n    edgesRef.current = edgesRef.current.filter(\n      e => !toRemove.has(e.source) && !toRemove.has(e.target)\n    );\n  \n    expandedNodesRef.current.delete(parentId);\n\n    newNodesRef.current = newNodesRef.current.map(n =>\n      n.id === parentId ? { ...n, data: { ...n.data, expanded: false } } : n\n    );\n  };\n\n  const computeBounds = (nodes) => {\n    if (nodes.length === 0) return null;\n    let minX = nodes[0].position.x;\n    let minY = nodes[0].position.y;\n    let maxX = nodes[0].position.x;\n    let maxY = nodes[0].position.y;\n\n    nodes.forEach(({ position, style }) => {\n      const width = (style?.width ?? 180); \n      const height = (style?.height ?? 80); \n      minX = Math.min(minX, position.x);\n      minY = Math.min(minY, position.y);\n      maxX = Math.max(maxX, position.x + width);\n      maxY = Math.max(maxY, position.y + height);\n    });\n\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n  };\n\n  \n  const handleDrill = useCallback(\n    async (nodeId) => {\n      const isExpanded = expandedNodesRef.current.has(nodeId);\n  \n      if (isExpanded) {\n        removeDescendants(nodeId);\n        setNodes(newNodesRef.current);\n        setEdges(edgesRef.current);\n        return;\n      }\n  \n      const node = await fetchNode(nodeId);\n      if (!node || !node.childrenData) return;\n  \n      const reportName = node.reportName;\n      const nextLevel = parseInt(node.level) + 1 || level + 1;\n      const entries = Object.entries(node.childrenData);\n      const totalChildren = entries.length;\n  \n      const parentNode = newNodesRef.current.find((n) => n.id === nodeId);\n      const baseX = parentNode?.position?.x + 450 || 250;\n      const centerY = parentNode?.position?.y || 0;\n      const verticalSpacing = 120;\n\n      let startY = 0;\n\n      function groupBounds(yStart) {\n        const firstChildY = yStart;\n        const lastChildY = yStart + (totalChildren - 1) * verticalSpacing;\n        const nodeHeight = 80;\n        return { top: firstChildY, bottom: lastChildY + nodeHeight };\n      }\n\n      const existingNodes = newNodesRef.current;\n      function isOverlapping(yStart, yEnd) {\n        return existingNodes.some(({ position, style }) => {\n          const nodeHeight = style?.height ?? 80;\n          const nodeYStart = position.y;\n          const nodeYEnd = nodeYStart + nodeHeight;\n          return !(yEnd < nodeYStart || yStart > nodeYEnd);\n        });\n      }\n  \n      let yOffset = 0;\n      while (isOverlapping(groupBounds(startY + yOffset).top, groupBounds(startY + yOffset).bottom)) {\n        yOffset += verticalSpacing;\n      }\n      startY += yOffset;\n  \n      entries.forEach(([childId, childLabel], index) => {\n        const childY = startY + index * verticalSpacing;\n  \n        edgesRef.current.push({\n          id: `e-${nodeId}-${childId}`,\n          source: nodeId,\n          sourceHandle: 'a',\n          target: childId,\n          targetHandle: 'a',\n        });\n  \n        newNodesRef.current.push({\n          id: childId,\n          type: 'customNode',\n          position: { x: baseX, y: childY },\n          data: {\n            label: childLabel.label,\n            id: childId,\n            reportName: reportName,\n            hasChildren: childLabel.hasChildren,\n            childrenNum: childLabel.childrenNum,\n            expanded: false,\n            onDrill: () => handleDrill(childId),\n          },\n        });\n      });\n  \n      expandedNodesRef.current.add(nodeId);\n      newNodesRef.current = newNodesRef.current.map(n =>\n        n.id === nodeId\n          ? {\n              ...n,\n              data: { ...n.data, expanded: true },\n            }\n          : n\n      );\n\n      const uniqueNodes = Array.from(new Map(newNodesRef.current.map((n) => [n.id, n])).values());\n      const uniqueEdges = Array.from(new Map(edgesRef.current.map((e) => [e.id, e])).values());\n  \n      setNodes(uniqueNodes);\n      setEdges(uniqueEdges);\n      setLevel(nextLevel);\n  \n      const subtreeNodeIds = [nodeId, ...entries.map(([childId]) => childId)];\n      const subtreeNodes = newNodesRef.current.filter(n => subtreeNodeIds.includes(n.id));\n      const bounds = computeBounds(subtreeNodes);\n  \n      if (bounds && reactFlowInstance.current) {\n        reactFlowInstance.current.fitBounds(bounds, {\n          padding: 0.4,\n          maxZoom: 1.5,\n        });\n      }\n    },\n    [level, reactFlowInstance]\n  );\n  \n  const onInit = useCallback((rfi) => {\n    reactFlowInstance.current = rfi;\n  }, []);\n\n  const fitViewWithDelay = () => {\n    setTimeout(() => {\n      if (reactFlowInstance.current) {\n        reactFlowInstance.current.fitView({ padding: 0.2 });\n      }\n    }, 100);\n  };\n\n  useEffect(() => {\n    const loadRoot = async () => {\n      const root = await fetchNode('EC140');\n      if (!root) return;\n\n      const rootId = root.parentId || 'EC140';\n      newNodesRef.current.push({\n        id: rootId,\n        type: 'customNode',\n        position: { x: 500, y: 50 },\n        data: {\n          label: root.parentName || 'Root Node',\n          id: rootId,\n          reportName : root.reportName,\n          hasChildren: true,\n          childrenNum : Object.entries(root.childrenData).length,\n          expanded: false,\n          onDrill: () => handleDrill(rootId),\n        },\n      });\n\n      setNodes(newNodesRef.current);\n    };\n    loadRoot();\n  }, []);\n\n  return (\n    <div style={{ width: '100vw', height: '100vh' }} ref={reactFlowWrapper}>\n      <ReactFlow\n        nodes={nodes}\n        edges={edges}\n        onNodesChange={onNodesChange}\n        onEdgesChange={onEdgesChange}\n        nodeTypes={nodeTypes}\n        fitView\n        fitViewOptions={{ padding: 0.4 }}\n        onInit={onInit}\n        defaultEdgeOptions={defaultEdgeOptions}\n      >\n        <Background />\n        <Controls />\n      </ReactFlow>\n    </div>\n  );\n};\n\nexport default KPIDiagram;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}