{"ast":null,"code":"var _jsxFileName = \"/Users/khalidabourkia/Desktop/diagram/client/src/components/KPIDiagram2.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useCallback, useEffect, useMemo, useRef, useState, memo } from 'react';\nimport ReactFlow, { Background, Controls, useNodesState, useReactFlow, useEdgesState, Handle, Position } from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport axios from 'axios';\nimport ReactDOM from 'react-dom';\nimport numeral from \"numeral\";\n\n// CustomNode component\n// import { motion, AnimatePresence } from 'framer-motion';\nimport { motion } from 'framer-motion';\nimport './KPIDiagram.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst HoverNode = ({\n  data\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"tooltip-box \",\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-white mb-3 \",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-amber-300\",\n      children: \"Interpr\\xE9tation\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 39\n    }, this), \" : \", data.interpretation]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 25,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-white mb-3\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-amber-300\",\n      children: \"Recommandations\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 38\n    }, this), \" : \", data.recommandations]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 26,\n    columnNumber: 5\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-white\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-semibold text-amber-300\",\n      children: \"Exemple\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 33\n    }, this), \" : \", data.example]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 27,\n    columnNumber: 5\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 23,\n  columnNumber: 3\n}, this);\n_c = HoverNode;\nconst CollapsibleField = ({\n  label,\n  value,\n  isLast,\n  singleInLastRow\n}) => {\n  const isReactNode = /*#__PURE__*/React.isValidElement(value);\n  const isObject = value && typeof value === \"object\" && !isReactNode;\n  if (isReactNode && value.props.children[1].includes(\"undefined\")) return;\n  if (value === undefined || value === null) return;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `mb-2 ${!isLast && !singleInLastRow ? \"border-r\" : \"\"} border-gray-300`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-between cursor-pointer text-xs font-bold text-blue-600\",\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [label, \":\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 44,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 7\n    }, this), isReactNode && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-xs text-gray-800 break-words mt-1\",\n      children: value\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 9\n    }, this), !isReactNode && !isObject && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-xs text-gray-800 break-words mt-1\",\n      children: String(value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 40,\n    columnNumber: 5\n  }, this);\n};\n\n// --- Custom node ---\n_c2 = CollapsibleField;\nconst CustomNode = /*#__PURE__*/_s(/*#__PURE__*/memo(_c3 = _s(({\n  data,\n  setSource\n}) => {\n  _s();\n  const [Clicked, setClicked] = useState(false);\n  const cardRef = useRef(null); // ðŸ‘ˆ This will hold the entire card\n\n  useEffect(() => {\n    function handleClickOutside(event) {\n      if (cardRef.current && !cardRef.current.contains(event.target)) {\n        setClicked(false); // Close popup if click is outside the card\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n  const fields = [{\n    label: 'Item',\n    value: data.eleType\n  }, ...(data.eleType === \"Rasio\" ? [{\n    label: 'Typeologie',\n    value: data.typology\n  }] : []), ...(data.eleType === \"Rasio\" ? [{\n    label: 'Famille du Rasio',\n    value: data.category\n  }] : []), {\n    label: 'Solde Value',\n    value: numeral(data.SoldeValue).format(\"0,0.[000,000]\")\n  }, {\n    label: 'Rapports contenant item',\n    value: data.Reports\n  }, {\n    label: 'MÃ©thode de calcul',\n    value: data.method\n  }, {\n    label: 'Designation',\n    value: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"font-semibold\",\n        children: data.nameFr\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 11\n      }, this), ` : ${data.signification}`]\n    }, void 0, true)\n  }];\n  return /*#__PURE__*/_jsxDEV(motion.div, {\n    ref: cardRef // ðŸ‘ˆ Attach ref to whole card\n    ,\n    initial: {\n      opacity: 0,\n      scale: 0.98\n    },\n    animate: {\n      opacity: 1,\n      scale: 1\n    },\n    exit: {\n      opacity: 0,\n      scale: 0.98\n    },\n    transition: {\n      duration: 0.2\n    },\n    className: `relative ${data.Type === \"Source\" ? \"w-[250px]\" : \"w-[900px] grid grid-cols-3 gap-2\"} bg-white border border-gray-200 rounded-xl p-4 shadow-sm font-sans `,\n    children: [data.Type === \"Source\" && /*#__PURE__*/_jsxDEV(\"select\", {\n      onChange: e => setSource(e.target.value),\n      children: ['Rind', 'Rges', 'Rliq', 'Rend', 'Rsol', 'Rren'].map(key => /*#__PURE__*/_jsxDEV(\"option\", {\n        value: key,\n        children: key\n      }, key, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"target\",\n      position: Position.Left,\n      className: \"opacity-0\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `absolute ${data.eleType === \"Rasio\" ? \" bg-orange-300\" : \" bg-blue-300\"} -top-[0.9rem] right-1/2 w-20 text-xl font-bold rounded text-center transform -translate-y-1/2 translate-x-1/2`,\n      children: data.parentId\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), data.interpretation && data.recommandations && data.example && /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"bg-yellow-100 text-yellow-700 w-10 rounded h-6 text-center\",\n      onClick: () => setClicked(true),\n      children: \"info\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }, this), Clicked && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 z-[9999]\",\n      children: [/*#__PURE__*/_jsxDEV(HoverNode, {\n        data: data\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"tooltip-arrow\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }, this), !data.Type && fields.map((field, idx) => {\n      const isLast = idx === fields.length - 1;\n      const singleInLastRow = fields.length % 3 === 1 && isLast;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: singleInLastRow ? \"col-span-3\" : \"\",\n        children: /*#__PURE__*/_jsxDEV(CollapsibleField, {\n          label: field.label,\n          value: field.value,\n          isLast: (idx + 1) % 3 === 0,\n          singleInLastRow: singleInLastRow\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 13\n        }, this)\n      }, idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 11\n      }, this);\n    }), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-base text-gray-700\",\n      children: data.label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, this), data.eleType !== \"Rasio\" && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `absolute ${data.sign === '+' ? 'bg-green-300' : 'bg-red-300'} top-1/2 left-[-1.5rem] w-6 rounded-full text-center transform -translate-y-1/2`,\n      children: data.sign\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 9\n    }, this), data.hasChildren && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: data.onDrill,\n      className: \"absolute bottom-2 right-2 text-sm bg-indigo-100 text-indigo-700 rounded px-2 py-0.5\",\n      children: data.expanded ? \"âˆ’\" : `${data.childrenNum} +`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Handle, {\n      type: \"source\",\n      position: Position.Right,\n      className: \"opacity-0\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 5\n  }, this);\n}, \"novuC6wvPq+7EvjxkVmVNDpE2dg=\")), \"novuC6wvPq+7EvjxkVmVNDpE2dg=\");\n_c4 = CustomNode;\nconst defaultEdgeOptions = {\n  // animated: true,\n  type: 'smoothstep'\n};\nconst KPIDiagram = () => {\n  _s2();\n  const [Source, setSource] = useState('Rind');\n  const [level, setLevel] = useState(0);\n  const newNodesRef = useRef([]);\n  const edgesRef = useRef([]);\n  const expandedNodesRef = useRef(new Set()); // Track expanded nodes\n  const reactFlowWrapper = useRef(null);\n  const reactFlowInstance = useRef(null);\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const nodeTypes = useMemo(() => ({\n    customNode: props => /*#__PURE__*/_jsxDEV(CustomNode, {\n      ...props,\n      setSource: setSource\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 30\n    }, this)\n  }), [setSource]);\n\n  // useEffect( ()=>{\n\n  //     const saveToDb = async ()=>{\n  //       try{\n  //         const result = await axios.get(`http://localhost:8000/api/data2/`);\n  //         console.log(result);\n  //       }\n  //       catch (error)\n  //       {\n  //         console.log(error);\n  //       }\n  //     } \n  //     saveToDb();\n\n  // }, [])\n  const fetchNode = async nodeId => {\n    try {\n      // if(node)\n      const res = await axios.get(`http://localhost:8000/api/node2/${nodeId}`);\n      return res.data.node;\n    } catch (error) {\n      console.error('Error fetching node:', error);\n      return null;\n    }\n  };\n  const removeDescendants = parentId => {\n    const toRemove = new Set();\n    const stack = [parentId];\n    while (stack.length > 0) {\n      const current = stack.pop();\n      const children = edgesRef.current.filter(e => e.source === current).map(e => e.target);\n      for (const childId of children) {\n        let otherParents = edgesRef.current.filter(e => e.target === childId && e.source !== current);\n        otherParents = otherParents.filter(par => {\n          let source = par.source;\n          while (true) {\n            const parentEdge = edgesRef.current.find(e => e.target === source);\n            if (!parentEdge) return true;\n            source = parentEdge.source;\n            if (source === current) return false;\n          }\n        });\n        if (otherParents.length === 0) {\n          stack.push(childId);\n          toRemove.add(childId);\n        }\n      }\n    }\n    newNodesRef.current = newNodesRef.current.filter(n => !toRemove.has(n.id));\n    edgesRef.current = edgesRef.current.filter(e => !toRemove.has(e.source) && !toRemove.has(e.target));\n    expandedNodesRef.current.delete(parentId);\n    newNodesRef.current = newNodesRef.current.map(n => n.id === parentId ? {\n      ...n,\n      data: {\n        ...n.data,\n        expanded: false\n      }\n    } : n);\n  };\n  const computeBounds = nodes => {\n    if (nodes.length === 0) return null;\n    let minX = nodes[0].position.x;\n    let minY = nodes[0].position.y;\n    let maxX = nodes[0].position.x;\n    let maxY = nodes[0].position.y;\n    nodes.forEach(({\n      position,\n      style\n    }) => {\n      var _style$width, _style$height;\n      const width = (_style$width = style === null || style === void 0 ? void 0 : style.width) !== null && _style$width !== void 0 ? _style$width : 180;\n      const height = (_style$height = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height !== void 0 ? _style$height : 1000;\n      minX = Math.min(minX, position.x);\n      minY = Math.min(minY, position.y);\n      maxX = Math.max(maxX, position.x + width);\n      maxY = Math.max(maxY, position.y + height);\n    });\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  };\n  const handleDrill = useCallback(async (nodeId, isRoot = false) => {\n    var _parentNode$position, _parentNode$position2;\n    const isExpanded = expandedNodesRef.current.has(nodeId);\n    if (isExpanded) {\n      removeDescendants(nodeId);\n      setNodes(newNodesRef.current);\n      setEdges(edgesRef.current);\n      return;\n    }\n    const node = await fetchNode(nodeId);\n    if (!node || !node.childrenData) return;\n\n    // const reportName = node.reportName;\n    const nextLevel = level + 1;\n    const entries = Object.entries(node.childrenData);\n    const totalChildren = entries.length;\n    const parentNode = newNodesRef.current.find(n => n.id === nodeId);\n    const baseX = isRoot ? (parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$position = parentNode.position) === null || _parentNode$position === void 0 ? void 0 : _parentNode$position.x) + 400 : (parentNode === null || parentNode === void 0 ? void 0 : (_parentNode$position2 = parentNode.position) === null || _parentNode$position2 === void 0 ? void 0 : _parentNode$position2.x) + 1000;\n    const verticalSpacing = 300;\n    let startY = 0;\n    function hashString(str) {\n      let hash = 5381;\n      for (let i = 0; i < str.length; i++) {\n        hash = (hash << 5) + hash + str.charCodeAt(i); // hash * 33 + c\n        hash = hash & 0xffffffff; // force to 32-bit integer\n      }\n      return hash >>> 0; // force unsigned\n    }\n    function generateColorFromId(id, index) {\n      const saltedId = index + '-' + id; // add index to create more spread\n      const hash = hashString(saltedId);\n      const scrambled = hash * 2654435761 >>> 0;\n      const rawHue = scrambled % 360;\n      const step = 30;\n      const hue = Math.round(rawHue / step) * step;\n      return `hsl(${hue}, 70%, 60%)`;\n    }\n    function groupBounds(yStart) {\n      const firstChildY = yStart;\n      const lastChildY = yStart + (totalChildren - 1) * verticalSpacing;\n      const nodeHeight = 200;\n      return {\n        top: firstChildY,\n        bottom: lastChildY + nodeHeight\n      };\n    }\n    const existingNodes = newNodesRef.current;\n    function isOverlapping(yStart, yEnd) {\n      return existingNodes.some(({\n        position,\n        style\n      }) => {\n        var _style$height2;\n        const nodeHeight = (_style$height2 = style === null || style === void 0 ? void 0 : style.height) !== null && _style$height2 !== void 0 ? _style$height2 : 80;\n        const nodeYStart = position.y;\n        const nodeYEnd = nodeYStart + nodeHeight;\n        return !(yEnd < nodeYStart || yStart > nodeYEnd);\n      });\n    }\n    let yOffset = 0;\n    while (isOverlapping(groupBounds(startY + yOffset).top, groupBounds(startY + yOffset).bottom)) {\n      yOffset += verticalSpacing;\n    }\n    startY += yOffset;\n    entries.forEach(([childId, childLabel], index) => {\n      const childY = startY + index * verticalSpacing;\n      edgesRef.current.push({\n        id: `e-${nodeId}-${childId}`,\n        source: nodeId,\n        sourceHandle: 'a',\n        target: childId,\n        targetHandle: 'a',\n        style: {\n          stroke: generateColorFromId(nodeId),\n          strokeWidth: 2\n        }\n      });\n      // console.log(root)\n\n      newNodesRef.current.push({\n        id: childId,\n        type: 'customNode',\n        position: {\n          x: baseX,\n          y: childY\n        },\n        data: {\n          // label: childLabel.label,\n          id: childId,\n          // reportName: reportName,\n          ...childLabel,\n          sign: childLabel.childSign,\n          expanded: false,\n          onDrill: () => handleDrill(childId)\n        }\n      });\n    });\n    expandedNodesRef.current.add(nodeId);\n    newNodesRef.current = newNodesRef.current.map(n => n.id === nodeId ? {\n      ...n,\n      data: {\n        ...n.data,\n        expanded: true\n      }\n    } : n);\n    const uniqueNodes = Array.from(new Map(newNodesRef.current.map(n => [n.id, n])).values());\n    const uniqueEdges = Array.from(new Map(edgesRef.current.map(e => [e.id, e])).values());\n    setNodes(uniqueNodes);\n    setEdges(uniqueEdges);\n    setLevel(nextLevel);\n    const subtreeNodeIds = [nodeId, ...entries.map(([childId]) => childId)];\n    const subtreeNodes = newNodesRef.current.filter(n => subtreeNodeIds.includes(n.id));\n    const bounds = computeBounds(subtreeNodes);\n    if (bounds && reactFlowInstance.current) {\n      reactFlowInstance.current.fitBounds(bounds, {\n        padding: 0.4,\n        maxZoom: 1.5\n      });\n    }\n  }, [level, reactFlowInstance]);\n  const onInit = useCallback(rfi => {\n    reactFlowInstance.current = rfi;\n  }, []);\n  const fitViewWithDelay = () => {\n    setTimeout(() => {\n      if (reactFlowInstance.current) {\n        reactFlowInstance.current.fitView({\n          padding: 0.2\n        });\n      }\n    }, 100);\n  };\n  useEffect(() => {\n    const loadRoot = async () => {\n      setEdges([]);\n      newNodesRef.current = [];\n      const root = await fetchNode(Source);\n      if (!root) return;\n      const rootId = root.parentId || 'Rind';\n      newNodesRef.current.push({\n        id: rootId,\n        type: 'customNode',\n        position: {\n          x: 500,\n          y: 50\n        },\n        data: {\n          label: root.nameFr || 'Root Node',\n          id: rootId,\n          hasChildren: true,\n          Type: root.eleType,\n          childrenNum: Object.entries(root.childrenData).length,\n          expanded: false,\n          onDrill: () => handleDrill(rootId, true)\n        }\n      });\n      setNodes(newNodesRef.current);\n    };\n    loadRoot();\n  }, [Source]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      width: '100vw',\n      height: '100vh'\n    },\n    ref: reactFlowWrapper,\n    children: /*#__PURE__*/_jsxDEV(ReactFlow, {\n      nodes: nodes,\n      edges: edges,\n      onNodesChange: onNodesChange,\n      onEdgesChange: onEdgesChange,\n      nodeTypes: nodeTypes,\n      fitView: true,\n      fitViewOptions: {\n        padding: 0.4\n      },\n      onInit: onInit,\n      defaultEdgeOptions: defaultEdgeOptions,\n      children: [/*#__PURE__*/_jsxDEV(Background, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Controls, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 469,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 468,\n    columnNumber: 5\n  }, this);\n};\n_s2(KPIDiagram, \"zPUPyX0rWIOIORgUo109ubmkfMI=\", false, function () {\n  return [useNodesState, useEdgesState];\n});\n_c5 = KPIDiagram;\nexport default KPIDiagram;\nvar _c, _c2, _c3, _c4, _c5;\n$RefreshReg$(_c, \"HoverNode\");\n$RefreshReg$(_c2, \"CollapsibleField\");\n$RefreshReg$(_c3, \"CustomNode$memo\");\n$RefreshReg$(_c4, \"CustomNode\");\n$RefreshReg$(_c5, \"KPIDiagram\");","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","memo","ReactFlow","Background","Controls","useNodesState","useReactFlow","useEdgesState","Handle","Position","axios","ReactDOM","numeral","motion","jsxDEV","_jsxDEV","Fragment","_Fragment","HoverNode","data","className","children","fileName","_jsxFileName","lineNumber","columnNumber","interpretation","recommandations","example","_c","CollapsibleField","label","value","isLast","singleInLastRow","isReactNode","isValidElement","isObject","props","includes","undefined","String","_c2","CustomNode","_s","_c3","setSource","Clicked","setClicked","cardRef","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","fields","eleType","typology","category","SoldeValue","format","Reports","method","nameFr","signification","div","ref","initial","opacity","scale","animate","exit","transition","duration","Type","onChange","e","map","key","type","position","Left","parentId","onClick","field","idx","length","sign","hasChildren","onDrill","expanded","childrenNum","Right","_c4","defaultEdgeOptions","KPIDiagram","_s2","Source","level","setLevel","newNodesRef","edgesRef","expandedNodesRef","Set","reactFlowWrapper","reactFlowInstance","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","nodeTypes","customNode","fetchNode","nodeId","res","get","node","error","console","removeDescendants","toRemove","stack","pop","filter","source","childId","otherParents","par","parentEdge","find","push","add","n","has","id","delete","computeBounds","minX","x","minY","y","maxX","maxY","forEach","style","_style$width","_style$height","width","height","Math","min","max","handleDrill","isRoot","_parentNode$position","_parentNode$position2","isExpanded","childrenData","nextLevel","entries","Object","totalChildren","parentNode","baseX","verticalSpacing","startY","hashString","str","hash","i","charCodeAt","generateColorFromId","index","saltedId","scrambled","rawHue","step","hue","round","groupBounds","yStart","firstChildY","lastChildY","nodeHeight","top","bottom","existingNodes","isOverlapping","yEnd","some","_style$height2","nodeYStart","nodeYEnd","yOffset","childLabel","childY","sourceHandle","targetHandle","stroke","strokeWidth","childSign","uniqueNodes","Array","from","Map","values","uniqueEdges","subtreeNodeIds","subtreeNodes","bounds","fitBounds","padding","maxZoom","onInit","rfi","fitViewWithDelay","setTimeout","fitView","loadRoot","root","rootId","fitViewOptions","_c5","$RefreshReg$"],"sources":["/Users/khalidabourkia/Desktop/diagram/client/src/components/KPIDiagram2.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState , memo} from 'react';\nimport ReactFlow, {\n  Background,\n  Controls,\n  useNodesState,\n  useReactFlow, \n  useEdgesState,\n  Handle,\n  Position,\n} from 'reactflow';\nimport 'reactflow/dist/style.css';\nimport axios from 'axios';\nimport ReactDOM from 'react-dom';\nimport numeral from \"numeral\";\n\n// CustomNode component\n// import { motion, AnimatePresence } from 'framer-motion';\nimport { motion } from 'framer-motion';\nimport './KPIDiagram.css'\n\nconst HoverNode = ({ data }) => (\n\n  <div className=\"tooltip-box \">\n   {/* <div className=\"font-semibold text-amber-400 mb-1\">nodeID: {data.id}</div> */}\n    <div className=\"text-white mb-3 \"><span className=\"font-semibold text-amber-300\">InterprÃ©tation</span> : {data.interpretation}</div>\n    <div className=\"text-white mb-3\"><span className=\"font-semibold text-amber-300\">Recommandations</span> : {data.recommandations}</div>\n    <div className=\"text-white\"><span className=\"font-semibold text-amber-300\">Exemple</span> : {data.example}</div>\n  </div>\n);\n\n\nconst CollapsibleField = ({ label, value, isLast, singleInLastRow }) => {\n  const isReactNode = React.isValidElement(value);\n\n  const isObject = value && typeof value === \"object\" && !isReactNode;\n  if(isReactNode && value.props.children[1].includes(\"undefined\"))\n    return\n  if (value === undefined || value === null) return;\n  return (\n    <div className={`mb-2 ${!isLast && !singleInLastRow ? \"border-r\" : \"\"} border-gray-300`}>\n      <div\n        className=\"flex items-center justify-between cursor-pointer text-xs font-bold text-blue-600\"\n      >\n        <span>{label}:</span>\n      </div>\n\n      {isReactNode && (\n        <div className=\"text-xs text-gray-800 break-words mt-1\">\n          {value}\n        </div>\n      )}\n\n      {!isReactNode && !isObject && (\n        <div className=\"text-xs text-gray-800 break-words mt-1\">{String(value)}</div>\n      )}\n\n    </div>\n  );\n};\n\n\n// --- Custom node ---\nconst CustomNode = memo(({ data, setSource }) => {\n  const [Clicked, setClicked] = useState(false);\n\n  const cardRef = useRef(null); // ðŸ‘ˆ This will hold the entire card\n\n  useEffect(() => {\n    function handleClickOutside(event) {\n      if (cardRef.current && !cardRef.current.contains(event.target)) {\n        setClicked(false); // Close popup if click is outside the card\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const fields = [\n    { label: 'Item', value: data.eleType },\n    ...(data.eleType === \"Rasio\" ? [{ label: 'Typeologie', value: data.typology }] : []),\n    ...(data.eleType === \"Rasio\" ? [{ label: 'Famille du Rasio', value: data.category }] : []),\n    { label: 'Solde Value', value: numeral(data.SoldeValue).format(\"0,0.[000,000]\") },\n    { label: 'Rapports contenant item', value: data.Reports },\n    { label: 'MÃ©thode de calcul', value: data.method },\n    {\n      label: 'Designation',\n      value: (\n        <>\n          <span className=\"font-semibold\">{data.nameFr}</span>\n          {` : ${data.signification}`}\n        </>\n      )\n    }\n  ];\n\n  return (\n    <motion.div\n      ref={cardRef} // ðŸ‘ˆ Attach ref to whole card\n      initial={{ opacity: 0, scale: 0.98 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.98 }}\n      transition={{ duration: 0.2 }}\n      className={`relative ${data.Type === \"Source\" ? \"w-[250px]\" : \"w-[900px] grid grid-cols-3 gap-2\"} bg-white border border-gray-200 rounded-xl p-4 shadow-sm font-sans `}\n    >\n      {data.Type === \"Source\" && (\n        <select onChange={(e) => setSource(e.target.value)}>\n          {['Rind', 'Rges', 'Rliq', 'Rend', 'Rsol', 'Rren'].map(key => (\n            <option key={key} value={key}>{key}</option>\n          ))}\n        </select>\n      )}\n\n      <Handle type=\"target\" position={Position.Left} className=\"opacity-0\" />\n\n      <div className={`absolute ${data.eleType === \"Rasio\" ? \" bg-orange-300\" : \" bg-blue-300\"} -top-[0.9rem] right-1/2 w-20 text-xl font-bold rounded text-center transform -translate-y-1/2 translate-x-1/2`}>\n        {data.parentId}\n      </div>\n\n      {data.interpretation && data.recommandations && data.example && (\n        <button\n          className=\"bg-yellow-100 text-yellow-700 w-10 rounded h-6 text-center\"\n          onClick={() => setClicked(true)}\n        >\n          info\n        </button>\n      )}\n\n      {Clicked && (\n        <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 z-[9999]\">\n          <HoverNode data={data} />\n          <div className=\"tooltip-arrow\" />\n        </div>\n      )}\n\n      {!data.Type && fields.map((field, idx) => {\n        const isLast = idx === fields.length - 1;\n        const singleInLastRow = fields.length % 3 === 1 && isLast;\n\n        return (\n          <div key={idx} className={singleInLastRow ? \"col-span-3\" : \"\"}>\n            <CollapsibleField\n              label={field.label}\n              value={field.value}\n              isLast={(idx + 1) % 3 === 0}\n              singleInLastRow={singleInLastRow}\n            />\n          </div>\n        );\n      })}\n\n      <div className=\"text-base text-gray-700\">{data.label}</div>\n\n      {data.eleType !== \"Rasio\" && (\n        <div className={`absolute ${data.sign === '+' ? 'bg-green-300' : 'bg-red-300'} top-1/2 left-[-1.5rem] w-6 rounded-full text-center transform -translate-y-1/2`}>\n          {data.sign}\n        </div>\n      )}\n\n      {data.hasChildren && (\n        <button\n          onClick={data.onDrill}\n          className=\"absolute bottom-2 right-2 text-sm bg-indigo-100 text-indigo-700 rounded px-2 py-0.5\"\n        >\n          {data.expanded ? \"âˆ’\" : `${data.childrenNum} +`}\n        </button>\n      )}\n\n      <Handle type=\"source\" position={Position.Right} className=\"opacity-0\" />\n    </motion.div>\n  );\n});\nconst defaultEdgeOptions = {\n  // animated: true,\n  type: 'smoothstep',\n};\n\nconst KPIDiagram = () => {\n  const [Source, setSource] = useState('Rind');\n  const [level, setLevel] = useState(0);\n  const newNodesRef = useRef([]);\n  const edgesRef = useRef([]);\n  const expandedNodesRef = useRef(new Set()); // Track expanded nodes\n  const reactFlowWrapper = useRef(null);\n  const reactFlowInstance = useRef(null); \n\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n\n  const nodeTypes = useMemo(\n    () => ({\n      customNode: (props) => <CustomNode {...props} setSource={setSource} />\n    }),\n    [setSource]\n  );\n\n\n  // useEffect( ()=>{\n    \n  //     const saveToDb = async ()=>{\n  //       try{\n  //         const result = await axios.get(`http://localhost:8000/api/data2/`);\n  //         console.log(result);\n  //       }\n  //       catch (error)\n  //       {\n  //         console.log(error);\n  //       }\n  //     } \n  //     saveToDb();\n   \n  // }, [])\n  const fetchNode = async (nodeId) => {\n    try {\n      // if(node)\n      const res = await axios.get(`http://localhost:8000/api/node2/${nodeId}`);\n      return res.data.node;\n    } catch (error) {\n      console.error('Error fetching node:', error);\n      return null;\n    }\n  };\n  const removeDescendants = (parentId) => {\n    const toRemove = new Set();\n    \n    const stack = [parentId];\n    \n    while (stack.length > 0) {\n      const current = stack.pop();\n    \n      const children = edgesRef.current\n      .filter(e => e.source === current)\n      .map(e => e.target);\n      \n      for (const childId of children) {\n        let otherParents = edgesRef.current.filter(\n          e => e.target === childId && e.source !== current\n        );\n        otherParents = otherParents.filter(par =>{\n          let source = par.source;\n          while(true)\n          {\n            const parentEdge = edgesRef.current.find(e => e.target === source);\n            if(!parentEdge)\n              return true;\n            source = parentEdge.source;\n            if(source === current)\n                return false;\n          }\n        })\n        if (otherParents.length === 0) {\n          stack.push(childId);\n          toRemove.add(childId);\n        }\n        \n      }\n    }\n    newNodesRef.current = newNodesRef.current.filter(n => !toRemove.has(n.id));\n    edgesRef.current = edgesRef.current.filter(\n      e => !toRemove.has(e.source) && !toRemove.has(e.target)\n    );\n  \n    expandedNodesRef.current.delete(parentId);\n\n    newNodesRef.current = newNodesRef.current.map(n =>\n      n.id === parentId ? { ...n, data: { ...n.data, expanded: false } } : n\n    );\n  };\n\n  const computeBounds = (nodes) => {\n    if (nodes.length === 0) return null;\n    let minX = nodes[0].position.x;\n    let minY = nodes[0].position.y;\n    let maxX = nodes[0].position.x;\n    let maxY = nodes[0].position.y;\n\n    nodes.forEach(({ position, style }) => {\n      const width = (style?.width ?? 180); \n      const height = (style?.height ?? 1000); \n\n      minX = Math.min(minX, position.x);\n      minY = Math.min(minY, position.y);\n      maxX = Math.max(maxX, position.x + width);\n      maxY = Math.max(maxY, position.y + height);\n    });\n\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n  };\n\n  \n  const handleDrill = useCallback(\n    async (nodeId, isRoot = false) => {\n      const isExpanded = expandedNodesRef.current.has(nodeId);\n  \n      if (isExpanded) {\n        removeDescendants(nodeId);\n        setNodes(newNodesRef.current);\n        setEdges(edgesRef.current);\n        return;\n      }\n  \n      const node = await fetchNode(nodeId);\n      if (!node || !node.childrenData) return;\n  \n      // const reportName = node.reportName;\n      const nextLevel = level + 1;\n      const entries = Object.entries(node.childrenData);\n      const totalChildren = entries.length;\n  \n      const parentNode = newNodesRef.current.find((n) => n.id === nodeId);\n      const baseX = isRoot ? parentNode?.position?.x + 400 : parentNode?.position?.x + 1000;\n      const verticalSpacing = 300;\n\n      let startY = 0;\n      function hashString(str) {\n        let hash = 5381;\n        for (let i = 0; i < str.length; i++) {\n          hash = ((hash << 5) + hash) + str.charCodeAt(i); // hash * 33 + c\n          hash = hash & 0xffffffff; // force to 32-bit integer\n        }\n        return hash >>> 0; // force unsigned\n      }\n      \n      function generateColorFromId(id, index) {\n        const saltedId = index + '-' + id; // add index to create more spread\n        const hash = hashString(saltedId);\n        const scrambled = (hash * 2654435761) >>> 0;\n        const rawHue = scrambled % 360;\n        \n        const step = 30;\n        const hue = Math.round(rawHue / step) * step;\n        \n        return `hsl(${hue}, 70%, 60%)`;\n      }\n      \n      \n      \n      \n      function groupBounds(yStart) {\n        const firstChildY = yStart;\n        const lastChildY = yStart + (totalChildren - 1) * verticalSpacing;\n        const nodeHeight = 200;\n        return { top: firstChildY, bottom: lastChildY + nodeHeight };\n      }\n\n      const existingNodes = newNodesRef.current;\n      function isOverlapping(yStart, yEnd) {\n        return existingNodes.some(({ position, style }) => {\n          const nodeHeight = style?.height ?? 80;\n          const nodeYStart = position.y;\n          const nodeYEnd = nodeYStart + nodeHeight;\n          return !(yEnd < nodeYStart || yStart > nodeYEnd);\n        });\n      }\n  \n      let yOffset = 0;\n      while (isOverlapping(groupBounds(startY + yOffset).top, groupBounds(startY + yOffset).bottom)) {\n        yOffset += verticalSpacing;\n      }\n      startY += yOffset;\n  \n      entries.forEach(([childId, childLabel], index) => {\n        const childY = startY + index * verticalSpacing;\n  \n        edgesRef.current.push({\n          id: `e-${nodeId}-${childId}`,\n          source: nodeId,\n          sourceHandle: 'a',\n          target: childId,\n          targetHandle: 'a',\n          style: {\n            stroke: generateColorFromId(nodeId),\n            strokeWidth: 2,\n          },\n        });\n        // console.log(root)\n        \n        newNodesRef.current.push({\n          id: childId,\n          type: 'customNode',\n          position: { x: baseX, y: childY },\n          data: {\n            // label: childLabel.label,\n            id: childId,\n            // reportName: reportName,\n            ...childLabel,\n            sign : childLabel.childSign,\n            expanded: false,\n            onDrill: () => handleDrill(childId),\n          },\n        });\n      });\n  \n      expandedNodesRef.current.add(nodeId);\n      newNodesRef.current = newNodesRef.current.map(n =>\n        n.id === nodeId\n          ? {\n              ...n,\n              data: { ...n.data, expanded: true },\n            }\n          : n\n      );\n\n      const uniqueNodes = Array.from(new Map(newNodesRef.current.map((n) => [n.id, n])).values());\n      const uniqueEdges = Array.from(new Map(edgesRef.current.map((e) => [e.id, e])).values());\n  \n      setNodes(uniqueNodes);\n      setEdges(uniqueEdges);\n      setLevel(nextLevel);\n  \n      const subtreeNodeIds = [nodeId, ...entries.map(([childId]) => childId)];\n      const subtreeNodes = newNodesRef.current.filter(n => subtreeNodeIds.includes(n.id));\n      const bounds = computeBounds(subtreeNodes);\n  \n      if (bounds && reactFlowInstance.current) {\n        reactFlowInstance.current.fitBounds(bounds, {\n          padding: 0.4,\n          maxZoom: 1.5,\n        });\n      }\n    },\n    [level, reactFlowInstance]\n  );\n  \n  const onInit = useCallback((rfi) => {\n    reactFlowInstance.current = rfi;\n  }, []);\n\n  const fitViewWithDelay = () => {\n    setTimeout(() => {\n      if (reactFlowInstance.current) {\n        reactFlowInstance.current.fitView({ padding: 0.2 });\n      }\n    }, 100);\n  };\n\n  useEffect(() => {\n    const loadRoot = async () => {\n      setEdges([]);\n      newNodesRef.current = [];\n      const root = await fetchNode(Source);\n      if (!root) return;\n\n      const rootId = root.parentId || 'Rind';\n      newNodesRef.current.push({\n        id: rootId,\n        type: 'customNode',\n        position: { x: 500, y: 50 },\n        data: {\n          label: root.nameFr || 'Root Node',\n          id: rootId,\n          hasChildren: true,\n          Type : root.eleType,\n          childrenNum : Object.entries(root.childrenData).length,\n          expanded: false,\n          onDrill: () => handleDrill(rootId, true),\n        },\n      });\n\n      setNodes(newNodesRef.current);\n    };\n    loadRoot();\n  }, [Source]);\n\n  return (\n    <div style={{ width: '100vw', height: '100vh' }} ref={reactFlowWrapper}>\n      <ReactFlow\n        nodes={nodes}\n        edges={edges}\n        onNodesChange={onNodesChange}\n        onEdgesChange={onEdgesChange}\n        nodeTypes={nodeTypes}\n        fitView\n        fitViewOptions={{ padding: 0.4 }}\n        onInit={onInit}\n        defaultEdgeOptions={defaultEdgeOptions}\n      >\n        <Background />\n        <Controls />\n      </ReactFlow>\n    </div>\n  );\n};\n\nexport default KPIDiagram;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}